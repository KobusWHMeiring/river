# PRD: Weeding Data Capture (Removal Metrics)

## 1. Problem Statement
The current system allows for tracking "Planting" (adding species) but lacks a dedicated interface for "Weeding" (removing invasive or unwanted species). Managers need to know not just what was added, but exactly what was removed and in what quantities to measure ecological impact.

## 2. Strategic Goal
To provide a first-class "Removal" interface within the Visit Log that mirrors the ease of the "Planting" interface, allowing supervisors to log multiple weed species and their quantities (bags or count) with minimal typing.

## 3. Proposed Scope
- **Metric Model Expansion:** Add a `weed` type to the `Metric` model.
- **Form UI Update:** Duplicate the "Planting Data" UI block to create a "Weeding Data" block in `visit_log_form.html`.
- **JavaScript Enhancement:** Update the dynamic formset logic to handle both planting and weeding species additions independently.
- **Reporting:** Ensure "Weeds Removed" shows up on the section dashboards and activity summaries.

## 4. Technical Constraints
- Must maintain compatibility with the existing `Metric` formset.
- Must handle multiple weeding species dynamically in the DOM (similar to `addPlantMetric`).

## 5. Implementation Details

### Species Data Entry
- **Free-text entry** for flexibility (no pre-defined species list)
- Use existing `label` field for species name (simple as-is)
- Users can specify unit per entry (count, bags, etc.) in label or separate field

### Dashboard Display
- **Section detail page:** Show both "Total Weeds Removed" (sum) and "Top 3 Species" breakdown
- **Format:** "Total Weeds Removed: 42" + "Wattle: 15, Kikuyu: 8, Other: 19"
- **Global dashboard:** Not included in initial implementation (will refine later)

### Visual Design
- **Icon:** `delete_forever` (trash/removal icon)
- **Color:** Use warning colors (orange/red) to distinguish from planting (green)
- **UI Location:** Below Planting section in Visit Log form

### Zero Quantity Handling
- If species added but quantity remains 0, **skip/save nothing** (cleaner data)
- Form validation should handle this gracefully

### Unit of Measurement
- Allow user to choose unit per entry (free text in label)
- No enforced unit system initially

### Form Layout
- Weeding section placed **below Planting** in Visit Log form
- Use same +/- button interface as planting
- Independent JavaScript function `addWeedMetric()` similar to `addPlantMetric()`

---

# User Stories (Generated by Technical PO)

## Story 1: "Weed" Metric Type Support
**Value Proposition:** As a Manager, I want "Weeding" to be a distinct data type in our database, so that I can report on invasive species removal separately from planting efforts.

**Technical Implementation Path:**
- Target File: `core/models.py`
  - Add `('weed', 'Weeding / Removal')` to `Metric.METRIC_TYPE_CHOICES`.
- Target File: `core/admin.py`
  - Ensure the admin list view for Metrics shows the new type.

**Acceptance Criteria (AC):**
- [ ] Database accepts `metric_type='weed'`.
- [ ] Strings and labels for weeding are consistent across the app.

**The Test Plan (MANDATORY):**
- **Unit Test:** Create a `Metric` instance with `metric_type='weed'`. Verify it saves and retrieves correctly.

---

## Story 2: Weeding Interface in Visit Log
**Value Proposition:** As a Supervisor, I want a dedicated area to log weeds removed using the same +/- buttons as planting, so that I can record my team's effort quickly in the field.

**Technical Implementation Path:**
- Target File: `core/templates/core/visit_log_form.html`
  - Create a new section "Weeding Data (Removal)" below the Planting section.
  - Implement a `addWeedMetric()` JS function (similar to `addPlantMetric`).
  - Use +/- buttons for quantities.
- Target File: `core/views.py` (`VisitLogCreateView`)
  - Ensure the formset logic handles the additional entries.

**Acceptance Criteria (AC):**
- [ ] User can click "Add Weed Species".
- [ ] User can enter species name (e.g., "Wattle") and increment/decrement quantity.
- [ ] Interface is visually distinct from planting (e.g., uses a different icon like `delete_forever` or `psychology_alt`).

**The Test Plan (MANDATORY):**
- **Integration Test:** Open Visit Log, add two weed species, set quantities, and submit. Verify `Metric` records are created with `metric_type='weed'`.
- **Edge Case:** "What if the user adds a species but leaves quantity at 0?" (System should ideally skip or save as 0; verify behavior).

---

## Story 3: Weeding Analytics on Section Dashboard
**Value Proposition:** As a Manager, I want to see "Total Weeds Removed" alongside "Total Plants Planted" on the section dashboard, so that I can see the full ecological balance.

**Technical Implementation Path:**
- Target File: `core/views.py` (`SectionDetailView`)
  - Update the `metrics_summary` query to include the `weed` type.
- Target File: `core/templates/core/section_detail.html`
  - Add a "Weeding Summary" card/stat (e.g., "Total Bags Removed").

**Acceptance Criteria (AC):**
- [ ] Section detail page displays a cumulative count of weeding activities.
- [ ] Statistics update immediately upon new log submission.

**The Test Plan (MANDATORY):**
- **Integration Test:** View a section detail page after logging a weeding activity. Verify the totals reflect the new data.

---

**CRITICAL STOP RULE:**
The current `Metric` model uses a `label` field for species names. Should we consider a pre-defined list of invasive species (like we have for task templates) to reduce typing further, or keep it free-text for now as requested?
