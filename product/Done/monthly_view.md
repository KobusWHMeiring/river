# PRD: Monthly Planning View

## 1. Problem Statement
The 7-day Weekly Planner is excellent for short-term coordination but lacks the perspective needed for monthly goal setting and resource allocation. Managers can't see "at a glance" if a section is getting enough attention over a 4-week period without paging through weeks.

## 2. Strategic Goal
To complement the Weekly Planner with a Monthly View that provides a high-level grid of the entire month, allowing managers to see task density, distribution, and overall project tempo.

## 3. Proposed Scope
- **Month View Grid:** A traditional calendar grid (4-5 weeks) showing scheduled tasks.
- **Task Representation:** Tasks in the month view will be summarized (icon + section color) to fit the smaller cell size.
### Interactivity: Context-Aware Navigation
- **Cell Click Logic:**
  - **If tasks exist:** Clicking anywhere in the day cell (on a badge or the background) navigates to the `DailyAgendaView` for that date.
  - **If no tasks exist:** Clicking the day cell opens the `TaskCreate` modal/form with the date pre-filled.
- **Visual Feedback:** All cells show a pointer cursor and a subtle "lift" or highlight on hover to indicate they are interactive.
- **Navigation:** Simple buttons to toggle between Month and Week views, and Previous/Next month controls.

## 4. Technical Constraints
- Must use Python's `calendar` module to generate the grid structure.
- Must ensure performance remains high when fetching 30+ days of tasks and their related sections.

## 5. Implementation Details

### Navigation Structure
- Side nav item changed to "Planner" (singular)
- Within Planner view, toggle buttons to switch between Weekly and Monthly views
- URLs use query params: `/planner/?view=monthly&month=2026-02` or `/planner/?view=weekly&week=2026-02-15`

### Task Display Layout
- **Split-cell layout** (consistent with weekly planner): Top half for Team tasks, bottom half for Manager tasks.
- **High-Density Representation:** Tasks are shown as small color-coded section badges (e.g., "[Mowbray]").
- **Overflow Handling:** If a cell exceeds 4 tasks (2 per split), show a "+X more" indicator that links to the Daily Agenda.
- Each task badge uses the section's `color_code` as a subtle left-border or background.
- Completed tasks shown with a checkmark icon and 50% opacity.

### Calendar Grid Specifications
- Week starts on **Monday**
- Use `calendar.Calendar(firstweekday=0)` (Monday = 0)
- Padding days from previous/next months are clickable and navigate to those dates
- Empty grid displayed when no tasks exist for the month

### Performance Optimizations
- Use `select_related('section')` when fetching tasks for the month
- Use `prefetch_related` where needed for related data
- No date range limits for now

### Tooltip Implementation
- Use native `title` attribute for simple hover information
- Display: section name, task instructions (truncated), assignee type
- Example: "Mowbray - Clear litter from pathway (Team)"

### View Toggle Behavior
- "Switch to Weekly View" button navigates to week containing the 1st of current month
- Weekly view has corresponding "Switch to Monthly View" button
- No "Today" button needed for MVP

### Responsive Design
- Mobile responsive can be ignored for now
- Focus on desktop layout only

---

# User Stories (Generated by Technical PO)

## Story 1: Monthly Calendar Grid Generation
**Value Proposition:** As a Manager, I want to see a full month's layout so that I can plan ahead for big events like community cleanup days or seasonal planting windows.

**Technical Implementation Path:**
- Target File: `core/views.py`
  - Create `MonthlyPlannerView` (ListView).
  - Use `calendar.Calendar().monthdatescalendar(year, month)` to build the grid.
- Target File: `core/urls.py`
  - Add `/monthly-planner/` and `/monthly-planner/<int:year>/<int:month>/`.

**Acceptance Criteria (AC):**
- [ ] View correctly displays days for the selected month, including padding days from previous/next months.
- [ ] Navigation allows moving to the next and previous months.
- [ ] The current month is identified and highlighted.

**The Test Plan (MANDATORY):**
- **Unit Test:** `test_month_grid_logic`: Verify that for February 2026, the view generates exactly 28 days (plus padding).
- **Edge Case:** "What happens on leap years or months starting on a Saturday?" (Verify grid alignment).

---

## Story 2: Summarized Task Indicators in Month View
**Value Proposition:** As a Manager, I want to see which sections are being worked on each day in the month view without the screen becoming cluttered, so I can see the "balance" of work across the river.

**Technical Implementation Path:**
- Target File: `core/templates/core/monthly_planner.html`
  - In each day cell, display small color-coded dots or icons representing the sections assigned to tasks that day.
  - Limit the number of indicators per cell (e.g., "3 more...") to avoid overflow.
- Target File: `core/views.py`
  - Fetch all tasks for the month range and group them by date for efficient template rendering.

**Acceptance Criteria (AC):**
- [ ] Each task is represented by its section's `color_code`.
- [ ] Tasks are categorized visually (e.g., a simple dot for Team, a small star for Manager).
- [ ] Hovering over an indicator shows the task's instructions or section name.

**The Test Plan (MANDATORY):**
- **Integration Test:** Add tasks to multiple days in a month. Load the month view and verify color indicators appear in the correct cells.
- **Edge Case:** "What if 10 tasks are on one day?" (Verify the UI handles overflow gracefully, e.g., with a scrollbar or "+X more" text).

---

## Story 3: Month-to-Week Seamless Navigation
**Value Proposition:** As a Manager, I want to move between the big picture (Month) and the details (Week/Day) with a single click, so that I can refine my plans efficiently.

**Technical Implementation Path:**
- Target File: `core/templates/core/monthly_planner.html`
  - Clicking a day number navigates to `DailyAgendaView` for that date.
  - Provide a toggle button "Switch to Weekly View" that jumps to the week containing the currently viewed month's start.
- Target File: `core/templates/core/weekly_planner.html`
  - Add a "Switch to Monthly View" button.

**Acceptance Criteria (AC):**
- [ ] Clicking a day in the month view takes the user to the correct daily agenda.
- [ ] The user can jump back and forth between views without losing their "place" in time.

**The Test Plan (MANDATORY):**
- **Integration Test:** Click February 15th in Month View -> Verify URL is `?date=2026-02-15`.
- **Edge Case:** "What if the user clicks a padding day from the next month?" (Verify it still takes them to the correct date).

---

**CRITICAL STOP RULE:**
The Monthly View might be quite dense. Should we show Manager and Team tasks in the same cell, or use a split-cell layout (similar to the weekly grid)?
