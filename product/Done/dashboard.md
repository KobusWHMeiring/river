# PRD: Global Activity Dashboard ("All Activities")

## 1. Problem Statement
While we have detailed views for individual sections and specific weeks, there is no "Big Picture" view. Managers cannot easily see the total impact of the project (e.g., "Total bags collected across the entire river this year") without manually aggregating data.

## 2. Strategic Goal
To create a high-impact, centralized "Star" dashboard that visualizes global rehabilitation metrics, recent activity trends, and section distribution, serving as the primary page for stakeholder reporting and impact analysis.

## 3. Proposed Scope
- **Aggregated Stats (Global Counters):** Lifetime totals for Litter (General/Recyclable), Plants, and Weeds.
- **Recent Activity Feed:** A unified list of the last 10-15 activities across all sections.
- **Stage Distribution:** A chart or breakdown showing how many sections are in each lifecycle stage.
- **Interactive Map Placeholder:** A styled area ready for future GIS integration.

## 4. Technical Constraints
- Must use Django's `Sum` and `Count` aggregations for performance.
- Must follow the "Subtle & Professional" UI standards (muted colors, thin borders).
- Must be the new "Home" or "Overview" entry point for the application.

---

# User Stories (Generated by Technical PO)

## Story 1: Global Impact Counters
**Value Proposition:** As a Manager, I want to see our project's total impact (bags, plants, area) on the main dashboard, so that I can report our success to the board and community instantly.

**Technical Implementation Path:**
- Target File: `core/views.py`
  - Create `GlobalDashboardView` (ListView or TemplateView).
  - Aggregate `Metric.value` grouped by `metric_type`.
- Target File: `core/templates/core/dashboard.html`
  - Implement large, clean "Stat Cards" at the top of the page.

**Acceptance Criteria (AC):**
- [ ] Dashboard shows Total General Litter Bags.
- [ ] Dashboard shows Total Recyclable Bags.
- [ ] Dashboard shows Total Indigenous Plants Planted.
- [ ] Dashboard shows Total Weeding Activities (if implemented).

**The Test Plan (MANDATORY):**
- **Unit Test:** `test_dashboard_aggregation`: Add 5 VisitLogs with various metrics. Verify the dashboard totals match the sum.
- **Edge Case:** "What if there are zero metrics yet?" (Stat cards should show "0" rather than crashing or being empty).

---

## Story 2: Universal Activity Feed
**Value Proposition:** As a Manager, I want to see a feed of everything happening across the river in real-time, so that I can stay informed without checking every section individually.

**Technical Implementation Path:**
- Target File: `core/views.py`
  - Query the last 15 `VisitLog` entries, prefetching sections and photos.
- Target File: `core/templates/core/dashboard.html`
  - Create a "Recent Activity" vertical list.
  - Include small section-color badges and photo thumbnails.

**Acceptance Criteria (AC):**
- [ ] Feed shows Activity Date, Section Name, and Notes.
- [ ] Clicking an activity takes the user to that Section's Timeline.
- [ ] Thumbnails are visible if photos were uploaded.

**The Test Plan (MANDATORY):**
- **Integration Test:** Log a visit in "Mowbray". Go to Global Dashboard. Verify the visit appears at the top of the feed.

---

## Story 3: Lifecycle Stage Breakdown
**Value Proposition:** As a Manager, I want to see a summary of how many sections are in each stage (e.g., 5 in Clearing, 2 in Planting), so that I can assess our overall project maturity.

**Technical Implementation Path:**
- Target File: `core/views.py`
  - Group `Section` objects by `current_stage` and count.
- Target File: `core/templates/core/dashboard.html`
  - Display a "Stage Progress" bar or grid of badges with counts.

**Acceptance Criteria (AC):**
- [ ] Breakdown shows all 5 stages (Mitigation, Clearing, etc.).
- [ ] Numbers update automatically when a section's stage is transitioned.

**The Test Plan (MANDATORY):**
- **Integration Test:** Change a section from "Clearing" to "Planting". Verify the dashboard counts update accordingly.

---

**CRITICAL STOP RULE (RESOLVED):**
The Dashboard is currently data-heavy. Should we implement a "Date Range" filter (This Month, This Year, All Time) for the initial version, or stick to "All Time" for the MVP release?

**Decision:** All Time only (MVP) - simpler, faster to implement, matches current section detail views.

**Additional Decisions:**
1. Dashboard will be a separate page (`/dashboard`), not replace the home page (section_list).
2. UI patterns will follow existing templates (section_detail.html, etc.) for consistency.
3. All test plans described in the PRD will be implemented (unit test for aggregation, integration test for activity feed, etc.).

**Implementation Notes:**
- Use Django's `Sum` and `Count` aggregations for performance.
- Follow "Subtle & Professional" UI standards (muted colors, thin borders).
- Ensure dashboard is accessible via navigation menu as "Overview" or "Dashboard".
